# Platform config for Accton AS5610-52X (open-nos-as5610)
# ONL-style layout: https://github.com/opencomputeproject/OpenNetworkLinux
# See: packages/platforms/accton/powerpc/as5610-52x/platform-config/r0/src/lib/
#
# This is the single source of truth for loader, FIT, env, and installer layout.
# Implemented by: onie-installer/cumulus/init/accton_as5610_52x/platform.conf,
#                 platform.fdisk, uboot_env/, and install.sh.

---
powerpc-accton-as5610-52x-r0:

  flat_image_tree:
    kernel:
      # From kernel build (e500/PPC32); uImage → FIT kernel subimage (gzip at 0x0)
      image: uImage
    initramfs:
      # Optional; included in FIT so U-Boot sees kernel+ramdisk+fdt (required by 2013.01)
      image: initramfs.cpio.gz
    dtb:
      # Platform DTB: use Cumulus DTB (extract from their FIT) or ONL platform-built.
      # Minimal DTS (as5610_52x_minimal.dts) is for build-only; boot uses full DTB.
      name: powerpc-accton-as5610-52x-r0.dtb
      # In our FIT we use image name accton_as5610_52x_dtb to match cl.platform
    fit_config: accton_as5610_52x   # U-Boot: bootm ${loadaddr}#${cl.platform}

  loader:
    device: /dev/sda
    # USB mass storage at ONIE bus 1-1.3 → sdX
    # Partitions: kernel on 5, rootfs on 6 (single-slot)
    nos_bootcmds: usb_bootcmds   # usb start; usbboot $loadaddr ${usbdev}:$active_part && bootm ...

  environment:
    # U-Boot env on NOR (not reflashed by installer)
    device: /dev/mtd1
    env_offset: 0x00000000
    env_size: 0x00010000
    sector_size: 0x00010000
    # Installer applies env via: fw_setenv -f -s <script from uboot_env/*.inc>

  installer:
    # Simplified layout (single-slot); ONL uses ONL-BOOT/CONFIG/IMAGES/DATA.
    # We use MBR logicals on USB: sda5 = kernel FIT, sda6 = rootfs squashfs.
    - label: persist
      part: 1
      size: ~128MiB
    - label: extended
      part: 2
      contains: [5, 6]
    - label: rw_overlay
      part: 3
    - label: kernel
      part: 5
      size: 16MiB
      content: fit   # nos-powerpc.itb
    - label: rootfs
      part: 6
      size: ~289MiB
      content: squashfs
      root: true     # root=/dev/sda6 rootfstype=squashfs ro rootwait

  console:
    device: ttyS0
    baudrate: 115200
    # Set in U-Boot env: consoledev, baudrate → initargs builds console=ttyS0,115200
